<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swift Logistics - System Architecture Diagram</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            background: #f9fafb;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            color: #1f2937;
            background: #f3f4f6;
        }

        .tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .content {
            padding: 30px;
            display: none;
        }

        .content.active {
            display: block;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            background: white;
            overflow-x: auto;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2563eb;
        }

        .description {
            font-size: 0.95em;
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .info-box {
            background: #f0f4ff;
            border-left: 4px solid #2563eb;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .info-box strong {
            color: #1e3a8a;
        }

        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .key-point {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .key-point h4 {
            color: #1e3a8a;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .key-point p {
            color: #4b5563;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .footer {
            background: #f9fafb;
            padding: 20px;
            text-align: center;
            color: #6b7280;
            font-size: 0.9em;
            border-top: 1px solid #e5e7eb;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 12px 15px;
                font-size: 0.9em;
            }

            .content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöö Swift Logistics</h1>
            <p>Courier Management System Architecture</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'architecture')">System Architecture</button>
            <button class="tab" onclick="switchTab(event, 'dataflow')">Data Flow</button>
            <button class="tab" onclick="switchTab(event, 'database')">Database Schema</button>
            <button class="tab" onclick="switchTab(event, 'auth')">Authentication Flow</button>
            <button class="tab" onclick="switchTab(event, 'components')">Component Structure</button>
        </div>

        <!-- SYSTEM ARCHITECTURE TAB -->
        <div id="architecture" class="content active">
            <h2 class="section-title">System Architecture Overview</h2>
            <p class="description">Complete architecture of the Swift Logistics application showing all layers and their interactions.</p>

            <div class="mermaid">
                graph TB
                    User["üë• End Users<br/>(Customers & Couriers)"]

                    Browser["üåê Web Browser"]
                    React["‚öõÔ∏è React Application<br/>TypeScript + Vite"]

                    Auth["üîê Authentication Layer<br/>Email/Password"]
                    API["üîå Supabase API Client<br/>@supabase/supabase-js"]

                    RLS["üõ°Ô∏è Row Level Security<br/>Access Control Policies"]
                    JWT["üîë JWT Tokens<br/>Session Management"]

                    DB["üóÑÔ∏è PostgreSQL Database<br/>Supabase Hosted"]
                    Cache["‚ö° Query Results<br/>Client Cache"]

                    User -->|visits| Browser
                    Browser -->|renders| React
                    React -->|authenticates| Auth
                    React -->|queries| API
                    API -->|validates| JWT
                    API -->|enforces| RLS
                    API -->|reads/writes| DB
                    API -->|caches| Cache

                    style User fill:#e3f2fd
                    style Browser fill:#f3e5f5
                    style React fill:#fff3e0
                    style Auth fill:#fce4ec
                    style API fill:#e0f2f1
                    style RLS fill:#f1f8e9
                    style JWT fill:#ede7f6
                    style DB fill:#e8eaf6
                    style Cache fill:#f0f4c3
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h4>Frontend Layer</h4>
                    <p>React + TypeScript + Tailwind CSS for responsive UI with Lucide React icons</p>
                </div>
                <div class="key-point">
                    <h4>Client Library</h4>
                    <p>Supabase JavaScript client handles all API calls and real-time updates</p>
                </div>
                <div class="key-point">
                    <h4>Authentication</h4>
                    <p>Email/password authentication with JWT token-based sessions</p>
                </div>
                <div class="key-point">
                    <h4>Backend</h4>
                    <p>Supabase managed PostgreSQL with Row Level Security policies</p>
                </div>
            </div>
        </div>

        <!-- DATA FLOW TAB -->
        <div id="dataflow" class="content">
            <h2 class="section-title">Data Flow Diagram</h2>
            <p class="description">Shows how data moves through the system during key operations.</p>

            <div class="info-box">
                <strong>Main Operations:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>User Registration & Login</li>
                    <li>Create Shipment</li>
                    <li>View Shipments</li>
                    <li>Track Shipment Status</li>
                    <li>Submit Contact Message</li>
                </ul>
            </div>

            <div class="mermaid">
                graph LR
                    U["User<br/>Action"]

                    Form["üìù Form Input<br/>Component"]
                    Validate["‚úì Client-side<br/>Validation"]
                    Request["üì§ HTTP Request<br/>via Supabase"]

                    Auth["üîê Auth Check<br/>JWT Token"]
                    RLS["üõ°Ô∏è RLS Policy<br/>Evaluation"]
                    DB["üóÑÔ∏è Database<br/>Operation"]

                    Response["üì• Response<br/>Data"]
                    Store["üíæ State Update<br/>React Hook"]
                    Render["üé® UI Update<br/>Rerender"]

                    User_Display["üëÅÔ∏è User Sees<br/>Result"]

                    U --> Form
                    Form --> Validate
                    Validate -->|valid| Request
                    Validate -->|invalid| Render

                    Request --> Auth
                    Auth -->|authorized| RLS
                    Auth -->|denied| Response
                    RLS -->|allowed| DB
                    RLS -->|denied| Response

                    DB -->|query result| Response
                    Response --> Store
                    Store --> Render
                    Render --> User_Display

                    style U fill:#bbdefb
                    style Form fill:#fff9c4
                    style Validate fill:#ffecb3
                    style Request fill:#ffe0b2
                    style Auth fill:#ffccbc
                    style RLS fill:#ffab91
                    style DB fill:#ff8a65
                    style Response fill:#ff7043
                    style Store fill:#ff5722
                    style Render fill:#e64a19
                    style User_Display fill:#d84315
            </div>
        </div>

        <!-- DATABASE SCHEMA TAB -->
        <div id="database" class="content">
            <h2 class="section-title">Database Schema & Relationships</h2>
            <p class="description">Entity relationship diagram showing all tables and their relationships.</p>

            <div class="mermaid">
                erDiagram
                    AUTH_USERS ||--o{ CUSTOMERS : creates
                    AUTH_USERS ||--o{ COURIERS : creates
                    CUSTOMERS ||--o{ SHIPMENTS : sends
                    COURIERS ||--o{ SHIPMENTS : delivers
                    SHIPMENTS ||--o{ TRACKING_EVENTS : generates

                    AUTH_USERS {
                        uuid id PK
                        string email UK
                        string password
                        timestamp created_at
                    }

                    CUSTOMERS {
                        uuid id PK
                        uuid user_id FK
                        string full_name
                        string email
                        string phone
                        string address
                        timestamp created_at
                    }

                    COURIERS {
                        uuid id PK
                        uuid user_id FK
                        string full_name
                        string email
                        string phone
                        string vehicle_type
                        string license_number
                        string status
                        timestamp created_at
                    }

                    SHIPMENTS {
                        uuid id PK
                        string tracking_number UK
                        uuid customer_id FK
                        uuid courier_id FK
                        string sender_name
                        string sender_phone
                        string sender_address
                        string recipient_name
                        string recipient_phone
                        string recipient_address
                        numeric package_weight
                        string package_dimensions
                        string service_type
                        string status
                        timestamp estimated_delivery
                        timestamp actual_delivery
                        numeric price
                        string notes
                        timestamp created_at
                        timestamp updated_at
                    }

                    TRACKING_EVENTS {
                        uuid id PK
                        uuid shipment_id FK
                        string status
                        string location
                        string description
                        timestamp created_at
                    }

                    CONTACT_MESSAGES {
                        uuid id PK
                        string name
                        string email
                        string phone
                        string subject
                        string message
                        string status
                        timestamp created_at
                    }
            </div>

            <div class="info-box" style="margin-top: 20px;">
                <strong>Key Table Features:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>RLS Enabled:</strong> All tables have Row Level Security policies</li>
                    <li><strong>Indexes:</strong> Performance optimized for tracking_number, customer_id, courier_id</li>
                    <li><strong>Foreign Keys:</strong> Referential integrity with cascade delete</li>
                    <li><strong>Timestamps:</strong> Timezone-aware for audit trails</li>
                </ul>
            </div>
        </div>

        <!-- AUTHENTICATION FLOW TAB -->
        <div id="auth" class="content">
            <h2 class="section-title">Authentication & Authorization Flow</h2>
            <p class="description">Complete authentication lifecycle from signup to protected operations.</p>

            <div class="mermaid">
                sequenceDiagram
                    participant User
                    participant React
                    participant SupaAuth as Supabase Auth
                    participant JWT as JWT Token
                    participant RLS as RLS Policy
                    participant DB as Database

                    User->>React: Click Sign Up
                    React->>SupaAuth: signUp(email, password)
                    SupaAuth->>SupaAuth: Hash password & create user
                    SupaAuth->>JWT: Generate JWT token
                    JWT-->>React: Return auth token
                    React->>React: Store session in localStorage
                    React->>User: Redirect to Dashboard

                    User->>React: Create Shipment
                    React->>React: Gather form data
                    React->>JWT: Attach token to request
                    JWT-->>RLS: Send authenticated request
                    RLS->>RLS: Evaluate policy (auth.uid() = customer.user_id)
                    alt Policy Allows
                        RLS->>DB: Execute query
                        DB-->>RLS: Return data
                        RLS-->>React: Send response
                        React->>React: Update state
                        React->>User: Show result
                    else Policy Denies
                        RLS-->>React: Permission denied
                        React->>User: Show error
                    end
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h4>Registration</h4>
                    <p>New users create account with email/password. JWT generated automatically.</p>
                </div>
                <div class="key-point">
                    <h4>Login</h4>
                    <p>Credentials validated against auth.users table. Session token stored client-side.</p>
                </div>
                <div class="key-point">
                    <h4>Access Control</h4>
                    <p>RLS policies enforce data access. Users only see their own data.</p>
                </div>
                <div class="key-point">
                    <h4>Token Management</h4>
                    <p>JWT tokens included in all API requests. Auto-refresh on expiry.</p>
                </div>
            </div>
        </div>

        <!-- COMPONENTS TAB -->
        <div id="components" class="content">
            <h2 class="section-title">React Component Structure</h2>
            <p class="description">Component hierarchy and data flow throughout the application.</p>

            <div class="mermaid">
                graph TD
                    App["App.tsx<br/>Root Component"]

                    AuthProvider["AuthContext Provider<br/>Global Auth State"]
                    AppContent["AppContent<br/>Router & Navigation"]
                    Layout["Layout Component<br/>Header & Footer"]

                    Home["Home Page<br/>Landing"]
                    Track["Track Page<br/>Tracking Lookup"]
                    Services["Services Page<br/>Info"]
                    Contact["Contact Page<br/>Form"]
                    Login["Login Page<br/>Auth Forms"]
                    Dashboard["Dashboard Page<br/>Protected"]

                    CreateModal["Create Shipment Modal<br/>Form Handler"]
                    ShipmentList["Shipment List<br/>Table Display"]
                    Stats["Stats Cards<br/>Metrics"]

                    App --> AuthProvider
                    AuthProvider --> AppContent
                    AppContent --> Layout
                    Layout --> Home
                    Layout --> Track
                    Layout --> Services
                    Layout --> Contact
                    Layout --> Login
                    Layout --> Dashboard

                    Dashboard --> Stats
                    Dashboard --> ShipmentList
                    Dashboard --> CreateModal

                    style App fill:#bbdefb
                    style AuthProvider fill:#c8e6c9
                    style AppContent fill:#fff9c4
                    style Layout fill:#ffe0b2
                    style Home fill:#ffccbc
                    style Track fill:#ffccbc
                    style Services fill:#ffccbc
                    style Contact fill:#ffccbc
                    style Login fill:#ffccbc
                    style Dashboard fill:#ffab91
                    style CreateModal fill:#ff8a65
                    style ShipmentList fill:#ff8a65
                    style Stats fill:#ff8a65
            </div>

            <div class="info-box" style="margin-top: 20px;">
                <strong>Context & State Management:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>AuthContext:</strong> Manages user authentication state and session</li>
                    <li><strong>Component State:</strong> React hooks (useState) for local state</li>
                    <li><strong>Data Fetching:</strong> useEffect for loading data from Supabase</li>
                    <li><strong>Navigation:</strong> Client-side routing with page state</li>
                </ul>
            </div>
        </div>

        <div class="footer">
            <p>Swift Logistics Courier Management System | System Architecture Documentation</p>
            <p style="margin-top: 10px; font-size: 0.85em;">Powered by React, TypeScript, Tailwind CSS, and Supabase</p>
        </div>
    </div>

    <script>
        function switchTab(event, tabName) {
            // Hide all content
            const contents = document.querySelectorAll('.content');
            contents.forEach(content => content.classList.remove('active'));

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Reinitialize mermaid diagrams
            mermaid.contentLoaded();
        }

        // Initialize mermaid
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>
